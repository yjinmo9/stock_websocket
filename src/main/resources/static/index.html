<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"> <title>ì£¼ì‹ ê²€ìƒ‰ ì‹œìŠ¤í…œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <style>
        .box { border: 1px solid #ccc; padding: 20px; margin: 20px; width: 400px; border-radius: 10px;}
        input { padding: 5px; width: 200px; }
        button { padding: 5px 10px; cursor: pointer; }
    </style>
</head>
<body>
<h1>ğŸ“ˆ ì£¼ì‹ ìš”ì²­ ì‹œìŠ¤í…œ</h1>

<div class="box" style="background-color: #f0f8ff;">
    <h3>ğŸ” ì¢…ëª© ê²€ìƒ‰ (Payload ë°œì†¡)</h3>
    <p>ë³´ê³  ì‹¶ì€ ì¢…ëª© ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
    <input type="text" id="symbol-input" placeholder="ì˜ˆ: 005930 (ì‚¼ì„±ì „ì)">
    <button onclick="sendSearch()">ìš”ì²­í•˜ê¸°</button>
</div>

<div class="box">
    <h3>ğŸ“© ìˆ˜ì‹ ëœ ê²°ê³¼</h3>
    <h2 id="search-result" style="color: blue;">ê²°ê³¼ ëŒ€ê¸°ì¤‘...</h2>
</div>

<script>
    var stompClient = null;

    function connect() {
        var socket = new SockJS('/ws-stock');
        stompClient = Stomp.over(socket);

        stompClient.connect({}, function (frame) {
            console.log('Connected: ' + frame);

            // [êµ¬ë…] ì„œë²„ê°€ "/topic/search-result"ë¡œ ë‹µì¥ ì£¼ë©´ ì—¬ê¸°ì„œ ë°›ìŒ
            stompClient.subscribe('/topic/search-result', function (message) {
                var stock = JSON.parse(message.body);
                showSearchResult(stock);
            });
        });
    }

    // [í•µì‹¬ ê¸°ëŠ¥] ë²„íŠ¼ ëˆ„ë¥´ë©´ ì‹¤í–‰!
    function sendSearch() {
        var symbol = document.getElementById("symbol-input").value;

        if(symbol === "") {
            alert("ì¢…ëª© ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
            return;
        }

        console.log("ë³´ë‚´ëŠ” Payload: " + symbol);

        // 1. ì—”ë“œí¬ì¸íŠ¸: "/app/search"
        // 2. í˜ì´ë¡œë“œ: {'symbol': ì…ë ¥í•œê°’} (JSONìœ¼ë¡œ í¬ì¥)
        stompClient.send("/app/search", {}, JSON.stringify({'symbol': symbol}));
    }

    function showSearchResult(stock) {
        document.getElementById("search-result").innerText =
            "[" + stock.symbol + "] " + stock.price + "ì›";
    }

    connect(); // ì‚¬ì´íŠ¸ ì¼œìë§ˆì ì—°ê²°
</script>
</body>
</html>