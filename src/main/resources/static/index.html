<!DOCTYPE html>
<html>
<head>
    <title>ì£¼ì‹ ì‹¤ì‹œê°„ ìƒí™©íŒ</title>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <style>
        body { font-family: 'Arial', sans-serif; padding: 20px; background-color: #f0f2f5; }
        h1 { color: #333; }
        #status { font-weight: bold; color: orange; margin-bottom: 20px; }
        .stock-card {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.2em;
        }
        .price { font-weight: bold; color: #d32f2f; }
        .time { font-size: 0.8em; color: #888; }
    </style>
</head>
<body>
<h1>ğŸ“ˆ ì‹¤ì‹œê°„ ì£¼ì‹ ì¤‘ê³„ì„</h1>
<div id="status">ì„œë²„ ì—°ê²° ì¤‘...</div>

<div id="stock-list"></div>

<script>
    var socket = new SockJS('/ws-stock');
    var stompClient = Stomp.over(socket);

    stompClient.connect({}, function (frame) {
        document.getElementById("status").innerText = "ğŸŸ¢ ì„œë²„ì™€ ì—°ê²°ë¨ (ì‹¤ì‹œê°„ ìˆ˜ì‹  ì¤‘)";
        document.getElementById("status").style.color = "green";

        // êµ¬ë… ì‹œì‘!
        stompClient.subscribe('/topic/stocks', function (message) {
            var stock = JSON.parse(message.body);
            updateStockUI(stock);
        });
    });

    function updateStockUI(stock) {
        var list = document.getElementById("stock-list");

        // ì´ë¯¸ í™”ë©´ì— ìˆëŠ” ì¢…ëª©ì¸ì§€ í™•ì¸ (IDë¡œ ì°¾ê¸°)
        var existingItem = document.getElementById(stock.symbol);

        var htmlContent = `
                <span><strong>${stock.symbol}</strong></span>
                <span class="price">${stock.price.toLocaleString()}ì›</span>
                <span class="time">${stock.timestamp}</span>
            `;

        if (existingItem) {
            // ì´ë¯¸ ìˆìœ¼ë©´ ë‚´ìš©ë§Œ ì—…ë°ì´íŠ¸ (ê¹œë¹¡ì„ íš¨ê³¼)
            existingItem.innerHTML = htmlContent;
            existingItem.style.backgroundColor = "#fff3e0"; // ì—…ë°ì´íŠ¸ ì‹œ ì‚´ì§ ë…¸ë€ìƒ‰
            setTimeout(() => existingItem.style.backgroundColor = "white", 300);
        } else {
            // ì—†ìœ¼ë©´ ìƒˆë¡œ ì¶”ê°€
            var newItem = document.createElement("div");
            newItem.id = stock.symbol; // ë‚˜ì¤‘ì— ì°¾ê¸° ì‰½ê²Œ ID ë¶€ì—¬
            newItem.className = "stock-card";
            newItem.innerHTML = htmlContent;
            list.prepend(newItem); // ë§¨ ìœ„ì— ì¶”ê°€
        }
    }
</script>
</body>
</html>